(function(c,C,s,I,E){"use strict";function S(n){if(n&&n.__esModule)return n;var t=Object.create(null);return n&&Object.keys(n).forEach(function(o){if(o!=="default"){var d=Object.getOwnPropertyDescriptor(n,o);Object.defineProperty(t,o,d.get?d:{enumerable:!0,get:function(){return n[o]}})}}),t.default=n,Object.freeze(t)}var a=S(C);const m=/https?:\/\/(?:\w+\.)?discord(?:app)?\.com\/channels\/(\d{17,19}|@me)\/(\d{17,19})\/(\d{17,19})/g,g=/\/channels\/(\d+|@me)(?:\/)?(\d+)(?:\/)(\d+)/,{default:B}=s.find(n=>n?.default?.type?.displayName==="ChannelMessage"),R=s.findByDisplayName("Embed"),_=s.findByProps("get","put"),f=s.findByProps("isAccessibleChannelOrThreadPath"),L=s.findByProps("createMessageRecord"),{getGuildIconURL:b}=s.findByProps("getGuildIconURL"),{renderMaskedLinkComponent:A}=s.findByProps("renderMaskedLinkComponent"),G=s.findByProps("getGuild"),D=s.findByProps("getChannel","getDMUserIds"),v=s.findByProps("getMessage","getMessages"),O=s.findByProps("MessageDisplayCompact"),U=s.findByProps("searchResult","message","buttonsContainer"),h=new Set,p=new Map;function N(n){const{message:t}=n,o=t.content.match(m),[,d]=a.useState(),z=a.useCallback(()=>d({}),[]);if(o){const P=[];for(const X of o){const $=X.match(g)[0],e=f.tryParseChannelPath($);if(e.messageId===t.id)continue;const i=e.guildId==="@me"?null:G.getGuild(e.guildId),u=D.getChannel(e.channelId),r=v.getMessage(e.channelId,e.messageId)||p.get(e.messageId);if(!r&&!h.has(e.messageId)&&(_.get({url:E.constants.Endpoints.MESSAGES(e.channelId),query:{limit:1,around:e.messageId},retries:2,oldFormErrors:!0}).then(l=>{p.set(e.messageId,L.createMessageRecord(l.body[0])),z()}),h.add(e.messageId)),!r||!u||!i&&e.guildId!="@me")continue;const M=r.content.match(m);if(M){let l=!1;for(const F of M){const K=F.match(g)[0];if(f.tryParseChannelPath(K).messageId===t.id){l=!0;break}}if(l)continue}const q=e.guildId==="@me"?null:b({id:i.id,icon:i.icon,size:24});P.push(a.createElement(R,{embed:{rawDescription:"",author:{name:e.guildId=="@me"?"Direct Message":`${i.name} - #${u.name}`,iconProxyURL:q}},renderLinkComponent:A,renderDescription:()=>a.createElement("div",{className:U.message,key:r.id},a.createElement(B,{id:"message-link-preview-"+r.id,message:r,channel:u,animateAvatar:!1,subscribeToComponentDispatch:!1,compact:O.MessageDisplayCompact.getSetting()}))}))}return P}return null}const{MessageAccessories:j}=s.findByProps("MessageAccessories");let y;function T(){y=I.after("render",j.prototype,function(n,t){this?.props&&t?.props&&t.props.children.push(a.createElement(N,{message:this.props.message}))})}const H=()=>y();return c.onLoad=T,c.onUnload=H,Object.defineProperty(c,"__esModule",{value:!0}),c})({},cumcord.modules.common.React,cumcord.modules.webpack,cumcord.patcher,cumcord.modules.common);
