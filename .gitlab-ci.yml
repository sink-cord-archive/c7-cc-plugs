image: node:16-alpine3.14

pages:
  stage: deploy
  before_script:
    - yarn global add sperm
  script:
    - mkdir .dist
    - cp index.html .dist
    - cp index.html .dist/404.html
    - for plugin in */; do cd "$plugin"; sperm build -o "../.dist/$plugin"; cd ..; done
    - node repoGen.js
    - mv .dist public
  artifacts:
    paths:
      - public
  only:
    - master